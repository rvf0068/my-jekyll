#+TITLE: Sympy and Matplotlib in Pyodide
#+DATE: 2025-11-08
#+AUTHOR: Author
#+JEKYLL_LAYOUT: post
#+JEKYLL_CATEGORIES: python
#+JEKYLL_TAGS: pyodide sympy matplotlib
#+HAS_PYTHON_CELLS: yes

Let us test symbolic math and graphics using Pyodide.

#+begin_export html
<!-- Load Pyodide once -->
<script>
  const pyodideReady = loadPyodide();
</script>
#+end_export

*Symbolic calculation with Sympy:*

#+begin_export html
<div class="py-cell">
  <textarea id="pycode1" rows="6" cols="60">
import sympy as sp
x = sp.symbols('x')
expr = sp.expand((x + 2)**3)
expr
  </textarea><br>
  <button id="run1">Run Sympy</button>
  <pre id="out1"></pre>
</div>

<script>
(async () => {
  const pyodide = await pyodideReady;
  await pyodide.loadPackage("sympy");
  document.getElementById("run1").onclick = async () => {
    const code = document.getElementById("pycode1").value;
    try {
      const result = await pyodide.runPythonAsync(code);
      document.getElementById("out1").textContent = result;
    } catch (err) {
      document.getElementById("out1").textContent = err;
    }
  };
})();
</script>
#+end_export

You can type your own expressions, e.g. try ~sp.integrate(sp.sin(x), x)~.

*Plotting with Matplotlib:*

#+begin_export html
<div class="py-cell">
  <textarea id="pycode2" rows="8" cols="60">
import matplotlib.pyplot as plt
import numpy as np
x = np.linspace(0, 2*np.pi, 100)
y = np.sin(x)
plt.plot(x, y)
plt.title("Sine Wave")
plt.xlabel("x")
plt.ylabel("sin(x)")
plt.grid(True)
plt.show()
  </textarea><br>
  <button id="run2">Run Plot</button><br>
  <div id="out2"></div>
</div>

<script>
(async () => {
  const pyodide = await pyodideReady;
  await pyodide.loadPackage(["micropip"]);
  await pyodide.runPythonAsync(`
import micropip
await micropip.install(["matplotlib", "numpy"])
  `);
  
  document.getElementById("run2").onclick = async () => {
    const code = document.getElementById("pycode2").value;
    try {
      const result = await pyodide.runPythonAsync(`
import matplotlib
matplotlib.use("AGG")
import io, base64
${code}
buf = io.BytesIO()
plt.savefig(buf, format='png')
buf.seek(0)
img_data = base64.b64encode(buf.read()).decode()
buf.close()
img_data
      `);
      const img = document.createElement("img");
      img.src = "data:image/png;base64," + result;
      const out2 = document.getElementById("out2");
      out2.innerHTML = "";
      out2.appendChild(img);
    } catch (err) {
      document.getElementById("out2").textContent = err;
    }
  };
})();
</script>
#+end_export

And you can try changing the function to ~np.cos(x)**2~ or add labels to explore.

A math test: \(e^{i\pi} + 1 = 0\). Another: \(\int_0^\infty e^{-x^2}\,dx = \frac{\sqrt{\pi}}{2}\).
